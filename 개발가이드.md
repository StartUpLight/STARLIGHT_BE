# StarLight 개발가이드

## 아키텍처
- 헥사고날 아키텍처
- 도메인 모델 패턴

### 계층
- Domain Layer
- Application Layer
- Adapter Layer

> 외부(Actor) -> 어댑터 -> 애플리케이션 -> 도메인

## 패키지
- domain
- application
    - required
    - provided
- adapter
    - webapi
    - persistence
    - integration
    - security
- shared
- bootstrap

## 유의사항
- 어댑터는 항상 포트(인터페이스)에만 의존한다.
- 어댑터 ↔ 어댑터 직접 의존 금지 (필요하면 새 포트를 애플리케이션에 정의).
- Inbound `provided`는 해당 도메인의 유스케이스만 노출한다.
- Outbound 포트는 소비자 도메인에서 정의한다(`application/<domain>/required`).
- Cross-domain 조회는 `OtherDomainLookupPort` 규칙을 따른다.
- 포트/타입 네이밍에서 `Lookup`을 한 단어로 사용한다(`LookupPort`). `LookUp` 표기는 사용하지 않는다.
- 다른 도메인의 `provided` 서비스를 직접 호출하지 않는다. 소비자 도메인에 `required` 포트를 정의하고, 제공 도메인의 어댑터가 구현한다.
- Response DTO는 애플리케이션 DTO로만 변환하고 엔티티를 직접 받지 않는다.
- 도메인 의미가 있는 포트는 소비자 도메인 `required`에 둔다.
- 순수 인프라 포트는 shared/infrastructure 패키지로 분리할 수 있다.

## 네이밍 규칙 요약
- Provided (inbound): `*UseCase`
- Required (outbound): `*Port`
- Cross-domain lookup: `OtherDomainLookupPort`
- Lookup 철자: `Lookup`만 사용 (`LookUp` 금지)
- 컬렉션을 함께 로딩하는 경우 이름에 컬렉션을 명시한다.
  - 예: `findAllWithCareersTagsCategories`, `findByIdWithCareersAndTags`
  - 예: `fetchExpertsWithCareersByIds`
- 영속성/조회 메서드의 실패-강제 조회는 `findByIdOrThrow`로 통일한다( `getOrThrow` 금지 ).
- 조회 동작은 `find*`로 통일한다(서비스/포트/어댑터). `get*`은 DTO getter 등 의미가 명확한 경우만 사용한다.
- 실패 동작을 이름으로 드러낸다.
  - Optional/nullable 반환: `findById`, `findByEmail`
  - 예외를 던짐: `findByIdOrThrow`, `findByTokenOrThrow`
  - 연관 강제 로딩: `findByIdWithCareersAndTags`, `fetchExpertsWithTagsByIds`
- 유스케이스(입력 포트) 메서드는 동사(행동) 중심으로 네이밍한다.
  - 예: `signIn`, `reissue`, `createReport`
- DTO 이름은 계층 역할을 드러낸다.
  - Web/API 입력: `*Request`
  - Web/API 출력: `*Response`
  - Application 입력: `*Input`
  - Application 출력: `*Result`

## API 응답 규칙
- 조회 API는 항상 데이터를 반환한다.
- 생성 API는 식별자 또는 핵심 결과만 반환한다.
- 수정/삭제 API는 기본적으로 `ApiResponse.success()`로 통일한다(응답 data 없음).
- 사용자 메시지가 필요한 액션(메일 전송 등)만 메시지 포함 응답을 사용한다.

## 포맷팅 규칙
- 컨트롤러 호출이 ~100자 이내면 한 줄로 유지한다.
- 인자가 래핑되면 한 줄에 한 인자로 멀티라인을 유지한다.
- 빌더나 `*Input.of(...)`는 인자가 2개 이상이면 멀티라인을 우선한다.
- 논리 단계별로 빈 줄을 넣어 구분한다(예: 조회 → 계산 → 반환).

## 도메인 검증 규칙
- `Assert`는 프로그래머 오류/불변식 위반에만 사용한다.
- 비즈니스 규칙 위반/사용자 입력 오류는 도메인 예외로 처리한다.

## 로컬 실행
- `./gradlew bootRun --args='--spring.profiles.active=dev'`

## 어댑터 레이어 shared 규칙
- adapter/shared/*(및 PDF·이미지 등 공용 인프라 어댑터)는 Lookup 포트가 아닌 직접 포트만 사용한다.
- 즉, PDF·사진(이미지) 등 여러 도메인에서 쓰는 기능은: application/pdf, application/storage 같은 공용 application 도메인을 두지 않는다.
- 사용하는 application 도메인마다 해당 도메인의 required에 직접 포트(예: PdfDownloadPort, PresignedUrlProviderPort)를 둔다.
